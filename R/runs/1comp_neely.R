rm(list = ls())
setwd("R")
source("NPOD.R")

pkdata_file <- "data/data_1comp_neely.csv"
sim_file <- ""
model <- function(theta,t){
    #this equation assumes a dose of 500mg, an infusion of 0.5h and a time vector like c(0.5,...)
    x05<-(500/(theta[1]*theta[2]))*(1-exp(-theta[1]*t[1]))
    val <- (x05/theta[2])*exp(-theta[1]*(t[-1]-0.5))
    return(c(x05,val))
}
params <- vector(mode = "list", length = 2) # K V
params[[1]] <- c(0.001, 50) # min
params[[2]] <- c(2, 250) #max
# population_data <- read_csv(population_file)
individuals <- seq(from=1, to=51)
t1<- system.time({
    ans <- NPOD(sim_file, pkdata_file, params, individuals, model=model, c0=0.01, c1=0.12, size_theta0=500000)
})

#-14548.37
#-14394.84
#-13147.4

#[1] -13789.39

# ans
# $count
# [1] 2

# $theta
#            [,1]       [,2]       [,3]       [,4]      [,5]       [,6]
# [1,]  0.1264255  0.1577819  0.1421037  0.1734601  0.165621  0.1185864
# [2,] 50.7324219 50.1831055 50.2746582 50.4577637 50.595093 50.0518799
#              [,7]       [,8]       [,9]
# [1,]  0.004919548  0.1303451  0.6226002
# [2,] 50.392150879 50.3433228 93.3965144

# $w
# [1] 0.01194834 0.02558830 0.05531179 0.03580223 0.05635014 0.10818590 0.58822013
# [8] 0.09898532 0.01960784

# $LogLikelihood
# [1] -12961.99

# ans
# $count
# [1] 2

# $theta
#            [,1]       [,2]       [,3]       [,4]       [,5]      [,6]
# [1,]  0.1577819  0.1421037  0.1283853  0.1127071  0.1675808  0.140144
# [2,] 50.1831055 50.2746582 50.1487732 50.1426697 50.0114441 50.241852
#              [,7]       [,8]     [,9]      [,10]      [,11]
# [1,]  0.001979887  0.6229461  0.17444  0.1234859  0.1332847
# [2,] 50.490188599 93.1842804 50.16670 50.1499176 50.0514984

# $w
#  [1] 0.019344071 0.022425826 0.074883552 0.038575085 0.087580111 0.039808420
#  [7] 0.588224270 0.019607843 0.010802842 0.091933068 0.006814913

# $LogLikelihood
# [1] -12929.35