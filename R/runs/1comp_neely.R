rm(list = ls())
setwd("R")
source("NPOD.R")

pkdata_file <- "data/data_1comp_neely.csv"
sim_file <- ""
model <- function(theta,t){
    #t<c(0.5,1,2,3,4,5,...)
    #this equation assumes a dose of 500mg, an infusion of 0.5h and a time vector like c(0.5,...)
    x05<-(500/(0.5*theta[1]*theta[2]))*(1-exp(-theta[1]*t[1]))
    val <- (x05)*exp(-theta[1]*(t[-1]-0.5))
    return(c(x05,val))
}
params <- vector(mode = "list", length = 2) # K V
params[[1]] <- c(0.001, 50) # min
params[[2]] <- c(2, 250) #max
# population_data <- read_csv(population_file)
individuals <- seq(from=1, to=51)
# theta_0 <- matrix(c(0.3144613,115.981,3.14E-02,80.72889,0.280948,100.9995,4.71E-02,117.1904,8.76E-02,84.10021,0.2878336,127.4758,7.06E-02,63.27646,2.15E-02,104.6166,0.3489143,77.26372,8.70E-02,105.1628,0.1301592,88.46613,0.3324822,89.57622,8.28E-02,86.12697,0.2886146,96.86714,7.86E-02,110.2691,0.1017387,131.5048,1.70E-02,118.6078,0.347585,97.85369,0.2908779,108.2393,7.06E-02,71.34714,0.308975,93.78251,9.60E-02,71.17576,0.3085995,118.3578,6.30E-02,102.7856,4.42E-02,90.28236,0.2963766,132.4404,8.17E-02,100.8137,9.46E-02,109.4395,7.20E-02,99.06245,6.67E-02,88.85164,6.50E-02,116.9147,0.1015817,91.99926,9.72E-02,85.61282,7.94E-02,128.8082,8.11E-02,110.8651,0.2937996,109.943,0.3187934,71.99469,0.1012032,105.819,0.354807,78.01133,0.2767081,130.6947,0.2907667,132.7285,0.2977832,100.6273,0.1124518,78.61398,0.295521,108.0799,6.97E-02,93.28156,2.70E-02,102.0951,0.3539666,86.4133,0.3352554,112.7408,8.99E-02,93.23766,0.1232762,99.42754,1,200), nrow=2)
theta_0<-matrix(unlist(read.csv("test.csv")),nrow=2)
t1<- system.time({
    ans <- NPOD(sim_file, pkdata_file, params, individuals, model=model, c0=0, c1=0.1, theta_0=theta_0)
})
